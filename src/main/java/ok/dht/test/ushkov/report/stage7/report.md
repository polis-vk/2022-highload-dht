# Отчет

## Описание модификации

Добавлена возможность указывать TTL для PUT запроса (параметр запроса ttl в миллисекундах).
Пример:
```bash
curl "http://<host>/v0/entity?id=1337&ttl=60000" -XPUT -d "1337"
```

Запись из примера просуществует 60 секунд, после чего сервер перестанет ее выдавать.

Протухающие записи никуда не исчезают и будут накапливаться со временем. 
Также давайте вспомним, что даже те записи, что были удалены ручкой, тоже копятся
и никуда не удаляются, так как мы зашили флаг tombstone прямо в запись.
Чтобы побороть все эти проблемы, была написана ручка `/v0/clean`. 
Она заставляет ноду временно прекратить принимать новые запросы и 
удаляет все протухшие и логически удаленные записи (те у которых tombstone=1).
Делает она это с помощью ручек RocksDB, сначала удаляя записи, затем запуская compaction.
Пример:
```bash
curl "http://<host>/v0/clean" -XGET
```

# Немного про код

В целях синхронизации были добавлены atomic bool и read-write lock.
atomic bool = true означает, что какой-то поток сейчас будет делать cleaning.
Взятый read lock означает, что на executor-е сейчас исполняется какой-то запрос.
Взятый write lock означает, что сейчас происходит cleaning. 
Два примитива нужны, чтобы различать ситуации:
 - сейчас исполняется другой запрос
 - cleaning уже начат в другом потоке

# Профилирование

Профилирование на мой взгляд не имеет смысла (мб я не прав).
Добавленные примитивы синхронизации не должны сильно аффектить нормальную работу
сервиса, так как единственный вызовы, которые добавятся это tryLock и unlock на read lock.
