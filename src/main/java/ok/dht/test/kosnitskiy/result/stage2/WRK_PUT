----Тест для сравнения со stage 1----
◆ utils git:(stage2) ✗ ❯❯❯ wrk -d 10 -t 4 -c 64 -R 20000 -s put-different.lua --latency "http://localhost:19234"
Running 10s test @ http://localhost:19234
  4 threads and 64 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     1.07ms    0.96ms  24.61ms   96.91%
    Req/Sec       -nan      -nan   0.00      0.00%
  Latency Distribution (HdrHistogram - Recorded Latency)
 50.000%    0.99ms
 75.000%    1.34ms
 90.000%    1.64ms
 99.000%    3.18ms
 99.900%   17.74ms
 99.990%   22.43ms
 99.999%   23.39ms
100.000%   24.62ms

  Detailed Percentile spectrum:
       Value   Percentile   TotalCount 1/(1-Percentile)

       0.044     0.000000            1         1.00
       0.415     0.100000        19975         1.11
       0.578     0.200000        39887         1.25
       0.716     0.300000        59897         1.43
       0.854     0.400000        79699         1.67
       0.990     0.500000        99701         2.00
       1.058     0.550000       109683         2.22
       1.128     0.600000       119542         2.50
       1.199     0.650000       129582         2.86
       1.269     0.700000       139468         3.33
       1.342     0.750000       149497         4.00
       1.380     0.775000       154500         4.44
       1.421     0.800000       159503         5.00
       1.465     0.825000       164382         5.71
       1.517     0.850000       169436         6.67
       1.576     0.875000       174406         8.00
       1.607     0.887500       176818         8.89
       1.643     0.900000       179316        10.00
       1.682     0.912500       181808        11.43
       1.727     0.925000       184323        13.33
       1.780     0.937500       186809        16.00
       1.810     0.943750       188044        17.78
       1.846     0.950000       189289        20.00
       1.891     0.956250       190519        22.86
       1.944     0.962500       191773        26.67
       2.011     0.968750       193028        32.00
       2.051     0.971875       193652        35.56
       2.101     0.975000       194263        40.00
       2.169     0.978125       194883        45.71
       2.269     0.981250       195502        53.33
       2.477     0.984375       196118        64.00
       2.633     0.985938       196430        71.11
       2.827     0.987500       196741        80.00
       3.037     0.989062       197053        91.43
       3.277     0.990625       197364       106.67
       3.617     0.992188       197675       128.00
       3.831     0.992969       197830       142.22
       4.077     0.993750       197985       160.00
       4.359     0.994531       198142       182.86
       4.743     0.995313       198298       213.33
       5.371     0.996094       198452       256.00
       5.855     0.996484       198532       284.44
       6.715     0.996875       198608       320.00
       7.967     0.997266       198686       365.71
       9.447     0.997656       198766       426.67
      11.231     0.998047       198841       512.00
      13.087     0.998242       198880       568.89
      13.951     0.998437       198919       640.00
      15.423     0.998633       198958       731.43
      16.799     0.998828       198997       853.33
      17.807     0.999023       199036      1024.00
      18.159     0.999121       199055      1137.78
      18.735     0.999219       199075      1280.00
      19.087     0.999316       199094      1462.86
      19.887     0.999414       199114      1706.67
      20.287     0.999512       199133      2048.00
      20.463     0.999561       199144      2275.56
      20.863     0.999609       199153      2560.00
      21.135     0.999658       199163      2925.71
      21.343     0.999707       199172      3413.33
      21.439     0.999756       199183      4096.00
      21.487     0.999780       199187      4551.11
      21.679     0.999805       199193      5120.00
      21.807     0.999829       199196      5851.43
      22.111     0.999854       199201      6826.67
      22.335     0.999878       199206      8192.00
      22.415     0.999890       199209      9102.22
      22.479     0.999902       199211     10240.00
      22.559     0.999915       199213     11702.86
      22.623     0.999927       199216     13653.33
      22.719     0.999939       199218     16384.00
      22.911     0.999945       199220     18204.44
      22.927     0.999951       199221     20480.00
      22.959     0.999957       199222     23405.71
      22.975     0.999963       199223     27306.67
      23.071     0.999969       199224     32768.00
      23.183     0.999973       199225     36408.89
      23.231     0.999976       199226     40960.00
      23.231     0.999979       199226     46811.43
      23.279     0.999982       199227     54613.33
      23.279     0.999985       199227     65536.00
      23.391     0.999986       199228     72817.78
      23.391     0.999988       199228     81920.00
      23.391     0.999989       199228     93622.86
      23.551     0.999991       199229    109226.67
      23.551     0.999992       199229    131072.00
      23.551     0.999993       199229    145635.56
      23.551     0.999994       199229    163840.00
      23.551     0.999995       199229    187245.71
      24.623     0.999995       199230    218453.33
      24.623     1.000000       199230          inf
#[Mean    =        1.073, StdDeviation   =        0.957]
#[Max     =       24.608, Total count    =       199230]
#[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  199242 requests in 10.00s, 12.73MB read
Requests/sec:  19924.28
Transfer/sec:      1.27MB

----Тестируем новые возможности-----
◆ utils git:(stage2) ✗ ❯❯❯ wrk -d 20s -t 4 -c 64 -R 95000 -s put-different.lua --latency "http://localhost:19234"
Running 20s test @ http://localhost:19234
  4 threads and 64 connections
  Thread calibration: mean lat.: 1.785ms, rate sampling interval: 10ms
  Thread calibration: mean lat.: 1.822ms, rate sampling interval: 10ms
  Thread calibration: mean lat.: 1.707ms, rate sampling interval: 10ms
  Thread calibration: mean lat.: 1.684ms, rate sampling interval: 10ms
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     1.72ms    1.51ms  23.65ms   88.03%
    Req/Sec    25.06k     4.08k   51.90k    77.98%
  Latency Distribution (HdrHistogram - Recorded Latency)
 50.000%    1.35ms
 75.000%    2.03ms
 90.000%    3.26ms
 99.000%    7.73ms
 99.900%   14.28ms
 99.990%   19.26ms
 99.999%   22.64ms
100.000%   23.66ms

  Detailed Percentile spectrum:
       Value   Percentile   TotalCount 1/(1-Percentile)

       0.021     0.000000            1         1.00
       0.506     0.100000        94384         1.11
       0.763     0.200000       188855         1.25
       0.966     0.300000       283101         1.43
       1.155     0.400000       377455         1.67
       1.347     0.500000       471241         2.00
       1.451     0.550000       518336         2.22
       1.565     0.600000       565478         2.50
       1.694     0.650000       612580         2.86
       1.843     0.700000       659755         3.33
       2.026     0.750000       706891         4.00
       2.137     0.775000       730572         4.44
       2.271     0.800000       754027         5.00
       2.435     0.825000       777514         5.71
       2.645     0.850000       801105         6.67
       2.915     0.875000       824738         8.00
       3.077     0.887500       836443         8.89
       3.261     0.900000       848145        10.00
       3.475     0.912500       859976        11.43
       3.727     0.925000       871771        13.33
       4.027     0.937500       883495        16.00
       4.207     0.943750       889437        17.78
       4.407     0.950000       895322        20.00
       4.639     0.956250       901224        22.86
       4.915     0.962500       907045        26.67
       5.247     0.968750       913004        32.00
       5.435     0.971875       915930        35.56
       5.643     0.975000       918865        40.00
       5.895     0.978125       921782        45.71
       6.203     0.981250       924721        53.33
       6.603     0.984375       927678        64.00
       6.843     0.985938       929144        71.11
       7.111     0.987500       930607        80.00
       7.467     0.989062       932071        91.43
       7.935     0.990625       933544       106.67
       8.527     0.992188       935021       128.00
       8.887     0.992969       935757       142.22
       9.327     0.993750       936492       160.00
       9.831     0.994531       937230       182.86
      10.399     0.995313       937963       213.33
      11.063     0.996094       938700       256.00
      11.439     0.996484       939066       284.44
      11.855     0.996875       939433       320.00
      12.271     0.997266       939809       365.71
      12.663     0.997656       940171       426.67
      13.079     0.998047       940537       512.00
      13.303     0.998242       940733       568.89
      13.519     0.998437       940910       640.00
      13.759     0.998633       941094       731.43
      14.007     0.998828       941275       853.33
      14.319     0.999023       941458      1024.00
      14.519     0.999121       941551      1137.78
      14.711     0.999219       941641      1280.00
      14.935     0.999316       941733      1462.86
      15.255     0.999414       941825      1706.67
      15.551     0.999512       941917      2048.00
      15.751     0.999561       941964      2275.56
      16.047     0.999609       942010      2560.00
      16.335     0.999658       942055      2925.71
      16.591     0.999707       942105      3413.33
      16.879     0.999756       942148      4096.00
      17.007     0.999780       942171      4551.11
      17.183     0.999805       942194      5120.00
      17.535     0.999829       942216      5851.43
      17.775     0.999854       942239      6826.67
      18.095     0.999878       942263      8192.00
      18.399     0.999890       942274      9102.22
      19.423     0.999902       942285     10240.00
      20.207     0.999915       942297     11702.86
      20.543     0.999927       942308     13653.33
      20.863     0.999939       942321     16384.00
      21.007     0.999945       942326     18204.44
      21.167     0.999951       942331     20480.00
      21.295     0.999957       942337     23405.71
      21.535     0.999963       942343     27306.67
      21.647     0.999969       942349     32768.00
      21.727     0.999973       942352     36408.89
      21.823     0.999976       942354     40960.00
      21.983     0.999979       942357     46811.43
      22.015     0.999982       942361     54613.33
      22.127     0.999985       942363     65536.00
      22.255     0.999986       942365     72817.78
      22.399     0.999988       942366     81920.00
      22.463     0.999989       942367     93622.86
      22.671     0.999991       942369    109226.67
      22.847     0.999992       942370    131072.00
      22.863     0.999993       942371    145635.56
      23.071     0.999994       942373    163840.00
      23.071     0.999995       942373    187245.71
      23.071     0.999995       942373    218453.33
      23.247     0.999996       942374    262144.00
      23.247     0.999997       942374    291271.11
      23.279     0.999997       942375    327680.00
      23.279     0.999997       942375    374491.43
      23.279     0.999998       942375    436906.67
      23.455     0.999998       942376    524288.00
      23.455     0.999998       942376    582542.22
      23.455     0.999998       942376    655360.00
      23.455     0.999999       942376    748982.86
      23.455     0.999999       942376    873813.33
      23.663     0.999999       942377   1048576.00
      23.663     1.000000       942377          inf
#[Mean    =        1.719, StdDeviation   =        1.512]
#[Max     =       23.648, Total count    =       942377]
#[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  1896153 requests in 20.00s, 121.16MB read
Requests/sec:  94811.16
Transfer/sec:      6.06MB


◆ utils git:(stage2) ✗ ❯❯❯ wrk -d 20s -t 4 -c 64 -R 105000 -s put-different.lua --latency "http://localhost:19234"
Running 20s test @ http://localhost:19234
  4 threads and 64 connections
  Thread calibration: mean lat.: 2.307ms, rate sampling interval: 10ms
  Thread calibration: mean lat.: 2.186ms, rate sampling interval: 10ms
  Thread calibration: mean lat.: 2.203ms, rate sampling interval: 10ms
  Thread calibration: mean lat.: 2.191ms, rate sampling interval: 10ms
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     1.89ms    1.56ms  22.56ms   83.60%
    Req/Sec    27.72k     5.09k   63.44k    77.37%
  Latency Distribution (HdrHistogram - Recorded Latency)
 50.000%    1.48ms
 75.000%    2.29ms
 90.000%    3.77ms
 99.000%    7.83ms
 99.900%   11.95ms
 99.990%   16.06ms
 99.999%   21.17ms
100.000%   22.58ms

  Detailed Percentile spectrum:
       Value   Percentile   TotalCount 1/(1-Percentile)

       0.023     0.000000            1         1.00
       0.518     0.100000       104290         1.11
       0.803     0.200000       208389         1.25
       1.037     0.300000       312692         1.43
       1.254     0.400000       416915         1.67
       1.480     0.500000       520866         2.00
       1.606     0.550000       573221         2.22
       1.743     0.600000       625165         2.50
       1.895     0.650000       677154         2.86
       2.071     0.700000       729531         3.33
       2.289     0.750000       781290         4.00
       2.425     0.775000       807353         4.44
       2.589     0.800000       833402         5.00
       2.789     0.825000       859513         5.71
       3.037     0.850000       885498         6.67
       3.355     0.875000       911493         8.00
       3.547     0.887500       924594         8.89
       3.767     0.900000       937484        10.00
       4.019     0.912500       950507        11.43
       4.311     0.925000       963648        13.33
       4.643     0.937500       976622        16.00
       4.839     0.943750       983066        17.78
       5.063     0.950000       989601        20.00
       5.311     0.956250       996096        22.86
       5.603     0.962500      1002633        26.67
       5.931     0.968750      1009111        32.00
       6.119     0.971875      1012396        35.56
       6.323     0.975000      1015656        40.00
       6.547     0.978125      1018862        45.71
       6.811     0.981250      1022157        53.33
       7.119     0.984375      1025396        64.00
       7.291     0.985938      1027001        71.11
       7.479     0.987500      1028655        80.00
       7.687     0.989062      1030278        91.43
       7.923     0.990625      1031895       106.67
       8.215     0.992188      1033531       128.00
       8.383     0.992969      1034347       142.22
       8.583     0.993750      1035175       160.00
       8.831     0.994531      1035978       182.86
       9.143     0.995313      1036783       213.33
       9.471     0.996094      1037592       256.00
       9.647     0.996484      1037989       284.44
       9.855     0.996875      1038399       320.00
      10.103     0.997266      1038810       365.71
      10.367     0.997656      1039208       426.67
      10.671     0.998047      1039616       512.00
      10.855     0.998242      1039818       568.89
      11.063     0.998437      1040021       640.00
      11.311     0.998633      1040229       731.43
      11.655     0.998828      1040430       853.33
      11.991     0.999023      1040632      1024.00
      12.183     0.999121      1040733      1137.78
      12.407     0.999219      1040838      1280.00
      12.623     0.999316      1040937      1462.86
      12.871     0.999414      1041040      1706.67
      13.167     0.999512      1041142      2048.00
      13.383     0.999561      1041192      2275.56
      13.663     0.999609      1041242      2560.00
      13.967     0.999658      1041292      2925.71
      14.327     0.999707      1041344      3413.33
      14.719     0.999756      1041395      4096.00
      14.927     0.999780      1041420      4551.11
      15.151     0.999805      1041445      5120.00
      15.319     0.999829      1041470      5851.43
      15.599     0.999854      1041496      6826.67
      15.799     0.999878      1041522      8192.00
      15.959     0.999890      1041534      9102.22
      16.103     0.999902      1041547     10240.00
      16.311     0.999915      1041559     11702.86
      16.623     0.999927      1041573     13653.33
      17.199     0.999939      1041587     16384.00
      17.263     0.999945      1041591     18204.44
      17.631     0.999951      1041598     20480.00
      17.823     0.999957      1041604     23405.71
      18.255     0.999963      1041610     27306.67
      18.655     0.999969      1041617     32768.00
      18.767     0.999973      1041620     36408.89
      18.863     0.999976      1041623     40960.00
      19.135     0.999979      1041626     46811.43
      19.487     0.999982      1041629     54613.33
      20.367     0.999985      1041633     65536.00
      20.511     0.999986      1041634     72817.78
      20.959     0.999988      1041637     81920.00
      20.959     0.999989      1041637     93622.86
      21.359     0.999991      1041639    109226.67
      21.583     0.999992      1041641    131072.00
      21.583     0.999993      1041641    145635.56
      21.679     0.999994      1041642    163840.00
      21.887     0.999995      1041643    187245.71
      22.015     0.999995      1041644    218453.33
      22.239     0.999996      1041645    262144.00
      22.239     0.999997      1041645    291271.11
      22.239     0.999997      1041645    327680.00
      22.383     0.999997      1041646    374491.43
      22.383     0.999998      1041646    436906.67
      22.447     0.999998      1041647    524288.00
      22.447     0.999998      1041647    582542.22
      22.447     0.999998      1041647    655360.00
      22.447     0.999999      1041647    748982.86
      22.447     0.999999      1041647    873813.33
      22.575     0.999999      1041648   1048576.00
      22.575     1.000000      1041648          inf
#[Mean    =        1.891, StdDeviation   =        1.558]
#[Max     =       22.560, Total count    =      1041648]
#[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  2095828 requests in 20.00s, 133.92MB read
Requests/sec: 104791.85
Transfer/sec:      6.70MB


◆ utils git:(stage2) ✗ ❯❯❯ wrk -d 20s -t 4 -c 64 -R 115000 -s put-different.lua --latency "http://localhost:19234"
Running 20s test @ http://localhost:19234
  4 threads and 64 connections
  Thread calibration: mean lat.: 2.638ms, rate sampling interval: 11ms
  Thread calibration: mean lat.: 2.625ms, rate sampling interval: 11ms
  Thread calibration: mean lat.: 2.727ms, rate sampling interval: 11ms
  Thread calibration: mean lat.: 2.526ms, rate sampling interval: 10ms
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     2.40ms    2.39ms  32.62ms   88.66%
    Req/Sec    30.26k     6.23k   63.60k    75.15%
  Latency Distribution (HdrHistogram - Recorded Latency)
 50.000%    1.67ms
 75.000%    2.88ms
 90.000%    5.13ms
 99.000%   12.07ms
 99.900%   20.00ms
 99.990%   28.19ms
 99.999%   31.36ms
100.000%   32.64ms

  Detailed Percentile spectrum:
       Value   Percentile   TotalCount 1/(1-Percentile)

       0.022     0.000000            1         1.00
       0.544     0.100000       114124         1.11
       0.852     0.200000       228314         1.25
       1.116     0.300000       342349         1.43
       1.373     0.400000       456726         1.67
       1.666     0.500000       570685         2.00
       1.833     0.550000       627691         2.22
       2.018     0.600000       684781         2.50
       2.237     0.650000       741967         2.86
       2.513     0.700000       799103         3.33
       2.881     0.750000       856062         4.00
       3.107     0.775000       884488         4.44
       3.375     0.800000       912977         5.00
       3.693     0.825000       941471         5.71
       4.073     0.850000       969954         6.67
       4.535     0.875000       998552         8.00
       4.811     0.887500      1012893         8.89
       5.127     0.900000      1027005        10.00
       5.507     0.912500      1041312        11.43
       5.943     0.925000      1055519        13.33
       6.459     0.937500      1069817        16.00
       6.759     0.943750      1076951        17.78
       7.103     0.950000      1084116        20.00
       7.487     0.956250      1091203        22.86
       7.911     0.962500      1098324        26.67
       8.407     0.968750      1105450        32.00
       8.711     0.971875      1109065        35.56
       9.071     0.975000      1112634        40.00
       9.503     0.978125      1116172        45.71
      10.015     0.981250      1119739        53.33
      10.615     0.984375      1123260        64.00
      10.991     0.985938      1125056        71.11
      11.367     0.987500      1126834        80.00
      11.775     0.989062      1128608        91.43
      12.287     0.990625      1130408       106.67
      12.831     0.992188      1132186       128.00
      13.127     0.992969      1133081       142.22
      13.479     0.993750      1133965       160.00
      13.887     0.994531      1134861       182.86
      14.343     0.995313      1135739       213.33
      14.887     0.996094      1136634       256.00
      15.167     0.996484      1137076       284.44
      15.447     0.996875      1137531       320.00
      15.751     0.997266      1137971       365.71
      16.095     0.997656      1138413       426.67
      16.495     0.998047      1138869       512.00
      16.735     0.998242      1139083       568.89
      17.087     0.998437      1139306       640.00
      17.663     0.998633      1139525       731.43
      18.687     0.998828      1139750       853.33
      20.207     0.999023      1139973      1024.00
      21.055     0.999121      1140083      1137.78
      22.063     0.999219      1140194      1280.00
      22.863     0.999316      1140305      1462.86
      23.631     0.999414      1140419      1706.67
      24.255     0.999512      1140530      2048.00
      24.511     0.999561      1140587      2275.56
      24.815     0.999609      1140645      2560.00
      25.135     0.999658      1140695      2925.71
      25.535     0.999707      1140751      3413.33
      26.015     0.999756      1140808      4096.00
      26.319     0.999780      1140836      4551.11
      26.575     0.999805      1140866      5120.00
      26.879     0.999829      1140890      5851.43
      27.327     0.999854      1140920      6826.67
      27.759     0.999878      1140946      8192.00
      28.031     0.999890      1140960      9102.22
      28.255     0.999902      1140974     10240.00
      28.527     0.999915      1140988     11702.86
      28.783     0.999927      1141003     13653.33
      29.151     0.999939      1141016     16384.00
      29.327     0.999945      1141024     18204.44
      29.583     0.999951      1141030     20480.00
      29.807     0.999957      1141038     23405.71
      29.967     0.999963      1141046     27306.67
      30.063     0.999969      1141051     32768.00
      30.159     0.999973      1141054     36408.89
      30.335     0.999976      1141058     40960.00
      30.511     0.999979      1141061     46811.43
      30.623     0.999982      1141065     54613.33
      30.799     0.999985      1141068     65536.00
      30.895     0.999986      1141070     72817.78
      31.103     0.999988      1141072     81920.00
      31.295     0.999989      1141073     93622.86
      31.535     0.999991      1141075    109226.67
      31.775     0.999992      1141077    131072.00
      31.887     0.999993      1141078    145635.56
      31.983     0.999994      1141079    163840.00
      31.983     0.999995      1141079    187245.71
      32.143     0.999995      1141080    218453.33
      32.223     0.999996      1141081    262144.00
      32.303     0.999997      1141082    291271.11
      32.303     0.999997      1141082    327680.00
      32.303     0.999997      1141082    374491.43
      32.479     0.999998      1141083    436906.67
      32.479     0.999998      1141083    524288.00
      32.511     0.999998      1141084    582542.22
      32.511     0.999998      1141084    655360.00
      32.511     0.999999      1141084    748982.86
      32.511     0.999999      1141084    873813.33
      32.511     0.999999      1141084   1048576.00
      32.639     0.999999      1141085   1165084.44
      32.639     1.000000      1141085          inf
#[Mean    =        2.399, StdDeviation   =        2.386]
#[Max     =       32.624, Total count    =      1141085]
#[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  2295453 requests in 20.00s, 146.67MB read
Requests/sec: 114777.73
Transfer/sec:      7.33MB