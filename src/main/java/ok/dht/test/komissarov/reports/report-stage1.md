## *Stage 1*

<hr>

Запуск `wrk2` и `async-profiler` производился из `wsl ubuntu 20.04`.  Процессор `Intel(R) Core(TM) i3-10110U CPU @ 2.10GHz   2.59 GHz :(`. В качестве базы данных взята реализация `Артёма Дроздова`.

## *wrk2*

<hr>

#### *PUT*

Для проверки `PUT` запросов были взяты значения `rate (-R)` равные `[5000, 7500, 10000]`

`Lua script:`

```lua
key = 0;

request = function()
    path = "/v0/entity?id=" .. key
    key = key + 1
    wrk.method = "PUT"
    wrk.body = "value"
    return wrk.format(nil, path)
end
```

За допустимое значение `Latency` возьмём `1ms`, если сервер отвечает дольше, то будем считать, что он не справляется с нагрузкой.

Результаты `PUT` запросов:

* `wrk -d 10 -t 1 -c 1 -R 5000 -s /mnt/c/scripts/put.lua http://192.168.3.4:19234` имеет показатель `830.90us`, что является допустимым значением.
* `wrk -d 10 -t 1 -c 1 -R 7500 -s /mnt/c/scripts/put.lua http://192.168.3.4:19234` имеет показатель `0,99ms`, что также является допустимым значением.
* `wrk -d 10 -t 1 -c 1 -R 10000 -s /mnt/c/scripts/put.lua http://192.168.3.4:19234` значение `Latency` становится нестабильным и при повторных запусках колеблется в диапазоне от `2ms` до `15ms`

Будем считать, что для исходной системы оптимальный `rate` - `7500`, поскольку имеет стабильный средний `Latency` в районе `1ms`

```
Thread Stats   Avg      Stdev     Max   +/- Stdev                                                                                                                    Latency     0.94ms    1.09ms  10.27ms   95.95%                                                                                                                      Req/Sec       -nan      -nan   0.00      0.00%                                                                                                                      Latency Distribution (HdrHistogram - Recorded Latency)                                                                                                              50.000%  779.00us                                                                                                                                                    75.000%    1.10ms                                                                                                                                                    90.000%    1.34ms                                                                                                                                                    99.000%    7.54ms                                                                                                                                                    99.900%    9.90ms                                                                                                                                                    99.990%   10.19ms                                                                                                                                                    99.999%   10.28ms                                                                                                                                                    100.000%   10.28ms
```                                                                                                            

Видно, что **`75%`** запросов обрабатываются за **`1.10ms`**, но оставшиеся запросы выполняются за недопустимо большое время, сервер перестает справляться с нагрузкой.

<hr>

#### *GET*

Для `GET` запросов были взяты аналогичные значения `rate (-R)` равные `[5000, 7500, 10000]`

`Lua script:`

```lua
key = 0

request = function()
    path = "/v0/entity?id=key" .. key
    key = key + 1
    wrk.method = "GET"
    wrk.body = "value"
    return wrk.format(nil, path)
end
```

Результаты `GET` запросов:

* `wrk -d 10 -t 1 -c 1 -R 5000 -s /mnt/c/scripts/get.lua http://192.168.3.4:19234` имеет показатель `798.89us`, что является допустимым значением.

* `wrk -d 10 -t 1 -c 1 -R 7500 -s /mnt/c/scripts/get.lua http://192.168.3.4:19234` имеет показатель `1.36ms`, что уже вываливается за допустимое значение.
* `wrk -d 10 -t 1 -c 1 -R 10000 -s /mnt/c/scripts/get.lua http://192.168.3.4:19234` имеет показатель `318.23ms`. Виден крайне значительный рост `Latency`, при `rate` равном `10000` сервер полноценно захлебывается и обрабатывает только `86%` поступающих запросов, имея показатель `Requests/sec` равным `8635`.

Таким образом, оптимальный `rate` для текущей системы `5000`.                                                                                                       ```
Thread Stats   Avg      Stdev     Max   +/- Stdev                                                                                                                    Latency     0.85ms  443.85us   4.36ms   65.81%                                                                                                                      Req/Sec       -nan      -nan   0.00      0.00%                                                                                                                      Latency Distribution (HdrHistogram - Recorded Latency)                                                                                                              50.000%  840.00us                                                                                                                                                    75.000%    1.16ms                                                                                                                                                    90.000%    1.41ms                                                                                                                                                    99.000%    1.88ms                                                                                                                                                    99.900%    3.58ms                                                                                                                                                    99.990%    4.26ms                                                                                                                                                    99.999%    4.37ms                                                                                                                                                    100.000%    4.37ms
```

`75%` запросов обрабатываются за менее, чем за  `1.16ms`, при повышении сервер, само собой, начинает не справляться с нагрузкой.

<hr>

## *Async-profiler*

<hr>

