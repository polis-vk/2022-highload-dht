Тестирование при 3 шардах, все запускалось на Mac m1 в трех jvm.
(Хотелось бы запускать на реальных физических машинах, но это стоит денег, а баллы за них давать пока что не очень
хотят)

# PUT

`wrk2 -R 20500 -c 64 -t 4 -d 30 -s src/main/java/ok/dht/test/ilin/scripts/put.lua -L http://localhost:19234`

```
Running 30s test @ http://localhost:19234
  4 threads and 64 connections
  Thread calibration: mean lat.: 1.706ms, rate sampling interval: 10ms
  Thread calibration: mean lat.: 1.744ms, rate sampling interval: 10ms
  Thread calibration: mean lat.: 1.720ms, rate sampling interval: 10ms
  Thread calibration: mean lat.: 1.723ms, rate sampling interval: 10ms
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     2.58ms    5.69ms  56.48ms   95.86%
    Req/Sec     5.40k   845.44    18.78k    87.00%
  Latency Distribution (HdrHistogram - Recorded Latency)
 50.000%    1.38ms
 75.000%    1.96ms
 90.000%    3.12ms
 99.000%   36.16ms
 99.900%   51.65ms
 99.990%   55.10ms
 99.999%   56.35ms
100.000%   56.51ms

  Detailed Percentile spectrum:
       Value   Percentile   TotalCount 1/(1-Percentile)

       0.097     0.000000            2         1.00
       0.631     0.100000        40886         1.11
       0.844     0.200000        81700         1.25
       1.028     0.300000       122683         1.43
       1.203     0.400000       163468         1.67
       1.382     0.500000       204324         2.00
       1.476     0.550000       224773         2.22
       1.574     0.600000       245098         2.50
       1.683     0.650000       265561         2.86
       1.806     0.700000       285914         3.33
       1.956     0.750000       306267         4.00
       2.046     0.775000       316540         4.44
       2.153     0.800000       326675         5.00
       2.285     0.825000       336990         5.71
       2.457     0.850000       347126         6.67
       2.705     0.875000       357327         8.00
       2.879     0.887500       362395         8.89
       3.121     0.900000       367511        10.00
       3.477     0.912500       372612        11.43
       3.983     0.925000       377708        13.33
       4.767     0.937500       382805        16.00
       5.331     0.943750       385351        17.78
       6.103     0.950000       387919        20.00
       7.467     0.956250       390461        22.86
      10.263     0.962500       393010        26.67
      14.791     0.968750       395565        32.00
      17.103     0.971875       396836        35.56
      19.775     0.975000       398112        40.00
      23.055     0.978125       399387        45.71
      26.799     0.981250       400666        53.33
      30.751     0.984375       401942        64.00
      32.447     0.985938       402582        71.11
      33.855     0.987500       403228        80.00
      35.295     0.989062       403858        91.43
      36.767     0.990625       404503       106.67
      39.007     0.992188       405130       128.00
      40.671     0.992969       405450       142.22
      42.559     0.993750       405767       160.00
      44.415     0.994531       406089       182.86
      45.791     0.995313       406417       213.33
      47.039     0.996094       406725       256.00
      47.583     0.996484       406884       284.44
      48.223     0.996875       407048       320.00
      48.831     0.997266       407204       365.71
      49.375     0.997656       407364       426.67
      49.983     0.998047       407522       512.00
      50.367     0.998242       407611       568.89
      50.591     0.998437       407681       640.00
      50.943     0.998633       407764       731.43
      51.295     0.998828       407843       853.33
      51.679     0.999023       407922      1024.00
      51.903     0.999121       407969      1137.78
      52.063     0.999219       408000      1280.00
      52.319     0.999316       408042      1462.86
      52.575     0.999414       408080      1706.67
      52.863     0.999512       408122      2048.00
      53.023     0.999561       408144      2275.56
      53.119     0.999609       408159      2560.00
      53.407     0.999658       408179      2925.71
      53.631     0.999707       408199      3413.33
      53.887     0.999756       408219      4096.00
      54.079     0.999780       408230      4551.11
      54.207     0.999805       408240      5120.00
      54.367     0.999829       408249      5851.43
      54.559     0.999854       408259      6826.67
      54.783     0.999878       408269      8192.00
      55.007     0.999890       408275      9102.22
      55.135     0.999902       408279     10240.00
      55.199     0.999915       408285     11702.86
      55.231     0.999927       408289     13653.33
      55.519     0.999939       408296     16384.00
      55.519     0.999945       408296     18204.44
      55.583     0.999951       408299     20480.00
      55.647     0.999957       408302     23405.71
      55.711     0.999963       408304     27306.67
      55.807     0.999969       408306     32768.00
      55.839     0.999973       408307     36408.89
      56.031     0.999976       408309     40960.00
      56.223     0.999979       408310     46811.43
      56.255     0.999982       408311     54613.33
      56.287     0.999985       408313     65536.00
      56.287     0.999986       408313     72817.78
      56.351     0.999988       408315     81920.00
      56.351     0.999989       408315     93622.86
      56.351     0.999991       408315    109226.67
      56.351     0.999992       408315    131072.00
      56.383     0.999993       408316    145635.56
      56.383     0.999994       408316    163840.00
      56.383     0.999995       408316    187245.71
      56.447     0.999995       408317    218453.33
      56.447     0.999996       408317    262144.00
      56.447     0.999997       408317    291271.11
      56.447     0.999997       408317    327680.00
      56.447     0.999997       408317    374491.43
      56.511     0.999998       408318    436906.67
      56.511     1.000000       408318          inf
#[Mean    =        2.580, StdDeviation   =        5.694]
#[Max     =       56.480, Total count    =       408318]
#[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  614199 requests in 30.00s, 39.24MB read
Requests/sec:  20473.12
Transfer/sec:      1.31MB
```

[Результаты профилирования `cpu`](put_hw_5_cpu.html)
[Результаты профилирования `alloc`](put_hw_5_alloc.html)
[Результаты_профилирования `lock`](put_hw_5_lock.html)

По сравнению с предыдущим этапом, сервер тратит меньше времени на запись ответа в сессию -- 15.53% заместо 22.78% это
время улучшить не представляется возможным, теперь мы не тратим время на ожидание на запросы с других нод.

Логика исполнения запросов а не отправки на другие ноды стало занимать 19.55% что не сильно больше чем было до этого.

На ожидании задачи из пула тратится больше чем было раньше -- 22.36% заместо 14.53%, на чтение запроса из сессии
тратится 14.94%, что немного меньше, и на селе тратим 5.82% что примерно так же как и было, улучшить это время не
получиться.

теперь ждем еще await work в fork join pool -- 11.37%.

В треде исполнения теперь не ждем результата, это стало лучше.

На профилировании не видны аллокации самой RocksDB, по этому не очень корректно оценивать реальные аллокации.

Теперь большую часть аллокаций тратится на запись респонса -- 60.74%

на сериализацию тратится 13.7%, 1.4% тратится на оставшиеся объекты в selfExecute. На сериализацию хотелось бы тратить
меньше, как и в прошлый раз думаю что улучшило бы это нормальная сериализация, но к сожалению она не доступна, а
доступна только способ из java

3.19% тратится на консистентое хеширование, и 10% тратиться на completable future -- они не бесплатные все же

на чтение сессии тратиться 6.87%

Большая часть ождания на локах происходит на получение задачи -- 69.35%, 20.45% ожидание на completable future, 8.39% на
то чтобы положить запрос в executor service.

Выдерживаемый рейт уменьшился до 20500

# GET

выдерживаемый рейт так же уменьшился, но не так сильно, выдерживается 22500.

`wrk2 -R 23500 -c 64 -t 4 -d 30 -s src/main/java/ok/dht/test/ilin/scripts/get.lua -L http://localhost:19234`

```
Running 30s test @ http://localhost:19234
  4 threads and 64 connections
  Thread calibration: mean lat.: 2.919ms, rate sampling interval: 10ms
  Thread calibration: mean lat.: 2.567ms, rate sampling interval: 10ms
  Thread calibration: mean lat.: 2.564ms, rate sampling interval: 10ms
  Thread calibration: mean lat.: 2.833ms, rate sampling interval: 10ms
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     1.95ms    2.26ms  43.26ms   94.17%
    Req/Sec     6.19k   799.58    14.20k    78.25%
  Latency Distribution (HdrHistogram - Recorded Latency)
 50.000%    1.47ms
 75.000%    2.17ms
 90.000%    3.35ms
 99.000%   11.56ms
 99.900%   28.54ms
 99.990%   38.46ms
 99.999%   41.95ms
100.000%   43.30ms

  Detailed Percentile spectrum:
       Value   Percentile   TotalCount 1/(1-Percentile)

       0.078     0.000000            1         1.00
       0.653     0.100000        46871         1.11
       0.877     0.200000        93731         1.25
       1.075     0.300000       140633         1.43
       1.271     0.400000       187307         1.67
       1.472     0.500000       234174         2.00
       1.579     0.550000       257656         2.22
       1.693     0.600000       280979         2.50
       1.824     0.650000       304295         2.86
       1.979     0.700000       327768         3.33
       2.173     0.750000       351291         4.00
       2.291     0.775000       362954         4.44
       2.427     0.800000       374567         5.00
       2.589     0.825000       386293         5.71
       2.785     0.850000       397934         6.67
       3.031     0.875000       409613         8.00
       3.181     0.887500       415495         8.89
       3.353     0.900000       421328        10.00
       3.555     0.912500       427222        11.43
       3.795     0.925000       433032        13.33
       4.099     0.937500       438918        16.00
       4.279     0.943750       441828        17.78
       4.495     0.950000       444738        20.00
       4.755     0.956250       447649        22.86
       5.091     0.962500       450581        26.67
       5.559     0.968750       453509        32.00
       5.875     0.971875       454980        35.56
       6.271     0.975000       456422        40.00
       6.783     0.978125       457880        45.71
       7.535     0.981250       459346        53.33
       8.519     0.984375       460818        64.00
       9.143     0.985938       461539        71.11
       9.863     0.987500       462271        80.00
      10.863     0.989062       463004        91.43
      12.159     0.990625       463733       106.67
      13.663     0.992188       464466       128.00
      14.583     0.992969       464829       142.22
      15.567     0.993750       465195       160.00
      16.703     0.994531       465563       182.86
      17.903     0.995313       465932       213.33
      19.215     0.996094       466292       256.00
      20.015     0.996484       466478       284.44
      20.943     0.996875       466658       320.00
      22.015     0.997266       466840       365.71
      23.551     0.997656       467023       426.67
      25.023     0.998047       467207       512.00
      25.839     0.998242       467298       568.89
      26.383     0.998437       467389       640.00
      27.103     0.998633       467481       731.43
      27.743     0.998828       467572       853.33
      28.671     0.999023       467664      1024.00
      29.151     0.999121       467709      1137.78
      29.823     0.999219       467755      1280.00
      30.335     0.999316       467800      1462.86
      30.943     0.999414       467846      1706.67
      31.567     0.999512       467892      2048.00
      31.999     0.999561       467916      2275.56
      32.383     0.999609       467939      2560.00
      32.927     0.999658       467960      2925.71
      33.631     0.999707       467983      3413.33
      34.495     0.999756       468006      4096.00
      35.071     0.999780       468018      4551.11
      36.063     0.999805       468029      5120.00
      36.671     0.999829       468040      5851.43
      37.471     0.999854       468053      6826.67
      37.983     0.999878       468065      8192.00
      38.143     0.999890       468069      9102.22
      38.559     0.999902       468075     10240.00
      38.975     0.999915       468080     11702.86
      39.199     0.999927       468086     13653.33
      39.679     0.999939       468092     16384.00
      40.127     0.999945       468095     18204.44
      40.287     0.999951       468098     20480.00
      40.415     0.999957       468100     23405.71
      40.479     0.999963       468103     27306.67
      40.767     0.999969       468106     32768.00
      41.439     0.999973       468108     36408.89
      41.663     0.999976       468109     40960.00
      41.791     0.999979       468110     46811.43
      41.823     0.999982       468112     54613.33
      41.855     0.999985       468114     65536.00
      41.855     0.999986       468114     72817.78
      41.951     0.999988       468115     81920.00
      41.951     0.999989       468115     93622.86
      42.271     0.999991       468116    109226.67
      42.495     0.999992       468117    131072.00
      42.495     0.999993       468117    145635.56
      42.783     0.999994       468118    163840.00
      42.783     0.999995       468118    187245.71
      42.783     0.999995       468118    218453.33
      43.199     0.999996       468119    262144.00
      43.199     0.999997       468119    291271.11
      43.199     0.999997       468119    327680.00
      43.199     0.999997       468119    374491.43
      43.199     0.999998       468119    436906.67
      43.295     0.999998       468120    524288.00
      43.295     1.000000       468120          inf
#[Mean    =        1.954, StdDeviation   =        2.256]
#[Max     =       43.264, Total count    =       468120]
#[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  704134 requests in 30.00s, 61.03MB read
Requests/sec:  23471.16
Transfer/sec:      2.03MB
```

[Результаты профилирования `cpu`](get_cpu_hw3.htm)
[Результаты профилирования `alloc`](get_alloc_hw3.htm)
[Результаты профилирования `lock`](get_lock_hw3.htm)

так же как и в прошлый раз много времени занимает запись ответа в сессию 23.95% заместо 26.79, на чтение из сессии 14.7
вместо 19.47%, на select селектора 5.59 вместо 5.41% и улучшить это не получится

много времени уходит на то чтобы взять задачу на исполнение -- 25.66% что больше чем в прошлой дз, где было 17.68% и
улучшить это не получится

к сожалению для нас, полезное время -- get из базы, как и в прошлый раз относительно не большой 3.44% что меньше чем в
прошлый раз, где было 4.58%.

На десериализацию тратим относительно много времени -- 3.32% (в прошлый раз было 3.31% -- осталось таким же), которая
возможно улучшилась бы, при использовании другого десериализатора

теперь не тратим время на получение результата future как в прошлый раз, но зато теперь тратим относительно много на
await work в fork join pool -- 14.59%, и улучшить это не получится

Так же как и в put много аллокаций тратиться на запись ответа -- 61.4%

на десериализацию тратим 13.7% что дешевле чем в прошлый раз, что можно было бы улучшить при использовании другого
десериализатора.

На чтение запроса тратиться 6.19% на запись

На профилировании не видны аллокации самой RocksDB, по этому не очень корректно оценивать реальные аллокации.

Большую часть времени ожидания локов ждем на то чтобы взять задачу из очереди -- 76.85%, 14.25% ждем на completable
future на offer в очредь в пул, 5.8% ждем на том чтобы положить запрос в очередь на исполнение, 
