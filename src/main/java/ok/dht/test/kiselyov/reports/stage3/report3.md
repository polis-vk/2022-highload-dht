Нагрузочное тестирование PUT в 64 потока, 64 соединения с 2 нодами:
-

> wrk -t 64 -c 64 -R 20000 -d 1m -s put.lua -L http://localhost:19234

Running 1m test @ http://localhost:19234

64 threads and 64 connections

Thread calibration: mean lat.: 18.456ms, rate sampling interval: 10ms

...

Thread calibration: mean lat.: 18.612ms, rate sampling interval: 10ms

    Thread Stats   Avg      Stdev       Max   +/- Stdev
    Latency     0.94ms   496.36us   18.58ms      73.42%
    Req/Sec     329.42      40.50     0.90k      82.47%
***
    Latency Distribution (HdrHistogram - Recorded Latency)
    50.000%    0.91ms
    75.000%    1.19ms
    90.000%    1.50ms
    99.000%    2.03ms
    99.900%    5.21ms
    99.990%   10.94ms
    99.999%   16.61ms
    100.000%  18.59ms

Detailed Percentile spectrum:

       Value   Percentile   TotalCount 1/(1-Percentile)

       0.023     0.000000            1         1.00
       0.369     0.100000       100466         1.11
       0.539     0.200000       200064         1.25
       0.682     0.300000       300478         1.43
       0.804     0.400000       400703         1.67
       0.914     0.500000       500465         2.00
       0.967     0.550000       550098         2.22
       1.020     0.600000       600783         2.50
       1.071     0.650000       650012         2.86
       1.124     0.700000       700321         3.33
       1.187     0.750000       750226         4.00
       1.228     0.775000       775173         4.44
       1.275     0.800000       800202         5.00
       1.326     0.825000       825037         5.71
       1.381     0.850000       850159         6.67
       1.437     0.875000       875076         8.00
       1.467     0.887500       887543         8.89
       1.498     0.900000       899871        10.00
       1.532     0.912500       912596        11.43
       1.569     0.925000       924982        13.33
       1.610     0.937500       937447        16.00
       1.634     0.943750       943833        17.78
       1.659     0.950000       950034        20.00
       1.687     0.956250       956198        22.86
       1.718     0.962500       962505        26.67
       1.755     0.968750       968639        32.00
       1.777     0.971875       971794        35.56
       1.801     0.975000       974888        40.00
       1.829     0.978125       978052        45.71
       1.863     0.981250       981136        53.33
       1.905     0.984375       984252        64.00
       1.932     0.985938       985831        71.11
       1.961     0.987500       987353        80.00
       1.999     0.989062       988927        91.43
       2.049     0.990625       990475       106.67
       2.115     0.992188       992039       128.00
       2.165     0.992969       992837       142.22
       2.229     0.993750       993607       160.00
       2.323     0.994531       994385       182.86
       2.475     0.995313       995157       213.33
       2.737     0.996094       995933       256.00
       2.905     0.996484       996324       284.44
       3.105     0.996875       996716       320.00
       3.327     0.997266       997106       365.71
       3.583     0.997656       997498       426.67
       3.885     0.998047       997885       512.00
       4.077     0.998242       998083       568.89
       4.307     0.998437       998276       640.00
       4.559     0.998633       998473       731.43
       4.899     0.998828       998666       853.33
       5.255     0.999023       998862      1024.00
       5.511     0.999121       998959      1137.78
       5.767     0.999219       999056      1280.00
       6.115     0.999316       999154      1462.86
       6.503     0.999414       999252      1706.67
       6.951     0.999512       999349      2048.00
       7.207     0.999561       999398      2275.56
       7.455     0.999609       999447      2560.00
       7.823     0.999658       999496      2925.71
       8.239     0.999707       999545      3413.33
       8.727     0.999756       999594      4096.00
       9.079     0.999780       999618      4551.11
       9.335     0.999805       999642      5120.00
       9.687     0.999829       999668      5851.43
       9.975     0.999854       999691      6826.67
      10.343     0.999878       999715      8192.00
      10.695     0.999890       999728      9102.22
      11.031     0.999902       999740     10240.00
      11.343     0.999915       999752     11702.86
      11.751     0.999927       999764     13653.33
      12.487     0.999939       999776     16384.00
      12.767     0.999945       999783     18204.44
      13.015     0.999951       999789     20480.00
      13.359     0.999957       999795     23405.71
      13.575     0.999963       999801     27306.67
      14.151     0.999969       999807     32768.00
      14.383     0.999973       999810     36408.89
      14.711     0.999976       999813     40960.00
      15.175     0.999979       999816     46811.43
      15.495     0.999982       999819     54613.33
      15.823     0.999985       999822     65536.00
      16.279     0.999986       999824     72817.78
      16.399     0.999988       999825     81920.00
      16.607     0.999989       999828     93622.86
      16.607     0.999991       999828    109226.67
      16.703     0.999992       999830    131072.00
      16.783     0.999993       999831    145635.56
      16.783     0.999994       999831    163840.00
      16.895     0.999995       999832    187245.71
      17.007     0.999995       999833    218453.33
      17.039     0.999996       999834    262144.00
      17.039     0.999997       999834    291271.11
      17.039     0.999997       999834    327680.00
      17.503     0.999997       999835    374491.43
      17.503     0.999998       999835    436906.67
      18.319     0.999998       999836    524288.00
      18.319     0.999998       999836    582542.22
      18.319     0.999998       999836    655360.00
      18.319     0.999999       999836    748982.86
      18.319     0.999999       999836    873813.33
      18.591     0.999999       999837   1048576.00
      18.591     1.000000       999837          inf
***
    #[Mean    =        0.937, StdDeviation   =        0.496]
    #[Max     =       18.576, Total count    =       999837]
    #[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
1199672 requests in 1.00m, 76.65MB read

Requests/sec:  19996.52

Transfer/sec:      1.28MB

Нагрузочное тестирование PUT в 64 потока, 64 соединения с 5 нодами:
-

> wrk -t 64 -c 64 -R 20000 -d 1m -s put.lua -L http://localhost:19234

Running 1m test @ http://localhost:19234

64 threads and 64 connections

Thread calibration: mean lat.: 4.270ms, rate sampling interval: 10ms

...

Thread calibration: mean lat.: 2.595ms, rate sampling interval: 10ms

    Thread Stats   Avg      Stdev       Max   +/- Stdev
    Latency     1.07ms     2.40ms  106.50ms      99.45%
    Req/Sec     329.69      55.88     3.00k      82.26%
***
    Latency Distribution (HdrHistogram - Recorded Latency)
    50.000%    0.92ms
    75.000%    1.21ms
    90.000%    1.56ms
    99.000%    2.54ms
    99.900%   47.07ms
    99.990%   80.51ms
    99.999%  103.17ms
    100.000% 106.56ms

Detailed Percentile spectrum:

       Value   Percentile   TotalCount 1/(1-Percentile)

       0.034     0.000000            1         1.00
       0.385     0.100000       100262         1.11
       0.543     0.200000       200475         1.25
       0.677     0.300000       300565         1.43
       0.799     0.400000       400219         1.67
       0.916     0.500000       500745         2.00
       0.972     0.550000       550417         2.22
       1.028     0.600000       600183         2.50
       1.083     0.650000       650055         2.86
       1.140     0.700000       700021         3.33
       1.210     0.750000       750225         4.00
       1.255     0.775000       775097         4.44
       1.307     0.800000       799879         5.00
       1.364     0.825000       824918         5.71
       1.424     0.850000       850149         6.67
       1.488     0.875000       875111         8.00
       1.522     0.887500       887396         8.89
       1.560     0.900000       899880        10.00
       1.602     0.912500       912391        11.43
       1.651     0.925000       925039        13.33
       1.707     0.937500       937459        16.00
       1.738     0.943750       943566        17.78
       1.775     0.950000       949977        20.00
       1.815     0.956250       956082        22.86
       1.863     0.962500       962405        26.67
       1.923     0.968750       968578        32.00
       1.960     0.971875       971737        35.56
       2.004     0.975000       974810        40.00
       2.057     0.978125       977934        45.71
       2.127     0.981250       981102        53.33
       2.217     0.984375       984169        64.00
       2.279     0.985938       985772        71.11
       2.355     0.987500       987296        80.00
       2.459     0.989062       988858        91.43
       2.595     0.990625       990420       106.67
       2.801     0.992188       991990       128.00
       2.953     0.992969       992766       142.22
       3.161     0.993750       993548       160.00
       3.491     0.994531       994321       182.86
       4.001     0.995313       995102       213.33
       4.859     0.996094       995884       256.00
       5.771     0.996484       996274       284.44
       7.279     0.996875       996665       320.00
      11.583     0.997266       997055       365.71
      19.727     0.997656       997447       426.67
      27.983     0.998047       997836       512.00
      31.855     0.998242       998031       568.89
      35.743     0.998437       998226       640.00
      39.679     0.998633       998424       731.43
      43.679     0.998828       998619       853.33
      47.615     0.999023       998812      1024.00
      49.631     0.999121       998910      1137.78
      51.519     0.999219       999007      1280.00
      53.567     0.999316       999105      1462.86
      55.807     0.999414       999204      1706.67
      58.015     0.999512       999300      2048.00
      59.423     0.999561       999349      2275.56
      61.151     0.999609       999398      2560.00
      63.007     0.999658       999448      2925.71
      65.119     0.999707       999496      3413.33
      68.479     0.999756       999544      4096.00
      70.399     0.999780       999569      4551.11
      72.255     0.999805       999593      5120.00
      74.175     0.999829       999618      5851.43
      76.735     0.999854       999642      6826.67
      78.207     0.999878       999666      8192.00
      79.935     0.999890       999679      9102.22
      80.767     0.999902       999691     10240.00
      82.175     0.999915       999703     11702.86
      85.439     0.999927       999715     13653.33
      88.831     0.999939       999727     16384.00
      90.367     0.999945       999734     18204.44
      91.967     0.999951       999740     20480.00
      94.335     0.999957       999747     23405.71
      95.103     0.999963       999752     27306.67
      97.471     0.999969       999758     32768.00
      97.727     0.999973       999761     36408.89
      98.431     0.999976       999764     40960.00
     100.479     0.999979       999768     46811.43
     100.671     0.999982       999770     54613.33
     101.183     0.999985       999773     65536.00
     102.271     0.999986       999775     72817.78
     103.103     0.999988       999776     81920.00
     103.167     0.999989       999778     93622.86
     103.551     0.999991       999779    109226.67
     103.871     0.999992       999781    131072.00
     104.127     0.999993       999782    145635.56
     104.127     0.999994       999782    163840.00
     105.343     0.999995       999783    187245.71
     105.471     0.999995       999784    218453.33
     105.791     0.999996       999785    262144.00
     105.791     0.999997       999785    291271.11
     105.791     0.999997       999785    327680.00
     106.047     0.999997       999786    374491.43
     106.047     0.999998       999786    436906.67
     106.239     0.999998       999787    524288.00
     106.239     0.999998       999787    582542.22
     106.239     0.999998       999787    655360.00
     106.239     0.999999       999787    748982.86
     106.239     0.999999       999787    873813.33
     106.559     0.999999       999788   1048576.00
     106.559     1.000000       999788          inf
***
    #[Mean    =        1.068, StdDeviation   =        2.396]
    #[Max     =      106.496, Total count    =       999788]
    #[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
1199972 requests in 1.00m, 76.67MB read

Requests/sec:  20001.65

Transfer/sec:      1.28MB

Нагрузочное тестирование GET в 64 потока, 64 соединения с 2 нодами:
-

> wrk -t 64 -c 64 -R 15000 -d 1m -s get.lua -L http://localhost:19234

Running 1m test @ http://localhost:19234

64 threads and 64 connections

Thread calibration: mean lat.: 1.092ms, rate sampling interval: 10ms

...

Thread calibration: mean lat.: 1.166ms, rate sampling interval: 10ms

    Thread Stats   Avg      Stdev      Max   +/- Stdev
    Latency     0.90ms   366.01us  11.78ms      69.53%
    Req/Sec     248.06      50.37   555.00      64.30%
***
    Latency Distribution (HdrHistogram - Recorded Latency)
    50.000%    0.89ms
    75.000%    1.14ms
    90.000%    1.33ms
    99.000%    1.64ms
    99.900%    3.31ms
    99.990%    7.92ms
    99.999%   11.05ms
    100.000%  11.78ms

Detailed Percentile spectrum:

       Value   Percentile   TotalCount 1/(1-Percentile)

       0.100     0.000000            1         1.00
       0.449     0.100000        75077         1.11
       0.574     0.200000       150125         1.25
       0.683     0.300000       225358         1.43
       0.787     0.400000       299930         1.67
       0.890     0.500000       375468         2.00
       0.941     0.550000       413169         2.22
       0.992     0.600000       450650         2.50
       1.043     0.650000       488010         2.86
       1.094     0.700000       525452         3.33
       1.145     0.750000       562851         4.00
       1.171     0.775000       581735         4.44
       1.197     0.800000       600224         5.00
       1.224     0.825000       618611         5.71
       1.254     0.850000       637340         6.67
       1.288     0.875000       656169         8.00
       1.307     0.887500       665630         8.89
       1.328     0.900000       675250        10.00
       1.349     0.912500       684218        11.43
       1.374     0.925000       693845        13.33
       1.401     0.937500       703075        16.00
       1.417     0.943750       707933        17.78
       1.433     0.950000       712517        20.00
       1.451     0.956250       717090        22.86
       1.471     0.962500       721755        26.67
       1.494     0.968750       726501        32.00
       1.507     0.971875       728805        35.56
       1.522     0.975000       731154        40.00
       1.538     0.978125       733440        45.71
       1.557     0.981250       735807        53.33
       1.580     0.984375       738181        64.00
       1.593     0.985938       739325        71.11
       1.608     0.987500       740491        80.00
       1.625     0.989062       741640        91.43
       1.647     0.990625       742809       106.67
       1.673     0.992188       743969       128.00
       1.691     0.992969       744543       142.22
       1.712     0.993750       745131       160.00
       1.739     0.994531       745716       182.86
       1.777     0.995313       746295       213.33
       1.837     0.996094       746881       256.00
       1.885     0.996484       747174       284.44
       1.960     0.996875       747466       320.00
       2.087     0.997266       747757       365.71
       2.241     0.997656       748050       426.67
       2.463     0.998047       748343       512.00
       2.603     0.998242       748491       568.89
       2.757     0.998437       748636       640.00
       2.921     0.998633       748784       731.43
       3.111     0.998828       748929       853.33
       3.337     0.999023       749075      1024.00
       3.489     0.999121       749148      1137.78
       3.637     0.999219       749222      1280.00
       3.845     0.999316       749295      1462.86
       4.029     0.999414       749369      1706.67
       4.311     0.999512       749441      2048.00
       4.487     0.999561       749479      2275.56
       4.659     0.999609       749515      2560.00
       4.959     0.999658       749552      2925.71
       5.247     0.999707       749588      3413.33
       5.687     0.999756       749624      4096.00
       5.955     0.999780       749643      4551.11
       6.251     0.999805       749661      5120.00
       6.551     0.999829       749679      5851.43
       6.963     0.999854       749698      6826.67
       7.419     0.999878       749716      8192.00
       7.667     0.999890       749725      9102.22
       7.983     0.999902       749734     10240.00
       8.191     0.999915       749743     11702.86
       8.559     0.999927       749753     13653.33
       8.791     0.999939       749763     16384.00
       8.919     0.999945       749766     18204.44
       9.183     0.999951       749771     20480.00
       9.631     0.999957       749775     23405.71
       9.943     0.999963       749780     27306.67
      10.183     0.999969       749785     32768.00
      10.311     0.999973       749787     36408.89
      10.367     0.999976       749789     40960.00
      10.423     0.999979       749791     46811.43
      10.695     0.999982       749794     54613.33
      10.807     0.999985       749796     65536.00
      10.903     0.999986       749798     72817.78
      10.903     0.999988       749798     81920.00
      10.919     0.999989       749799     93622.86
      11.127     0.999991       749801    109226.67
      11.215     0.999992       749802    131072.00
      11.215     0.999993       749802    145635.56
      11.327     0.999994       749803    163840.00
      11.327     0.999995       749803    187245.71
      11.439     0.999995       749804    218453.33
      11.471     0.999996       749805    262144.00
      11.471     0.999997       749805    291271.11
      11.471     0.999997       749805    327680.00
      11.471     0.999997       749805    374491.43
      11.487     0.999998       749806    436906.67
      11.487     0.999998       749806    524288.00
      11.487     0.999998       749806    582542.22
      11.487     0.999998       749806    655360.00
      11.487     0.999999       749806    748982.86
      11.783     0.999999       749807    873813.33
      11.783     1.000000       749807          inf
***
    #[Mean    =        0.897, StdDeviation   =        0.366]
    #[Max     =       11.776, Total count    =       749807]
    #[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
899951 requests in 1.00m, 58.27MB read

Requests/sec:  15003.07

Transfer/sec:      0.97MB

Нагрузочное тестирование GET в 64 потока, 64 соединения с 5 нодами:
-

> wrk -t 64 -c 64 -R 15000 -d 1m -s get.lua -L http://localhost:19234

Running 1m test @ http://localhost:19234

64 threads and 64 connections

Thread calibration: mean lat.: 0.990ms, rate sampling interval: 10ms

...

Thread calibration: mean lat.: 0.994ms, rate sampling interval: 10ms

    Thread Stats   Avg      Stdev      Max   +/- Stdev
    Latency     0.89ms   338.58us  12.60ms      66.98%
    Req/Sec     248.05      49.40   500.00      64.29%
***
    Latency Distribution (HdrHistogram - Recorded Latency)
    50.000%    0.89ms
    75.000%    1.13ms
    90.000%    1.30ms
    99.000%    1.58ms
    99.900%    2.95ms
    99.990%    4.99ms
    99.999%    6.55ms
    100.000%  12.61ms

Detailed Percentile spectrum:

       Value   Percentile   TotalCount 1/(1-Percentile)

       0.092     0.000000            1         1.00
       0.453     0.100000        75095         1.11
       0.580     0.200000       150303         1.25
       0.688     0.300000       225620         1.43
       0.789     0.400000       300561         1.67
       0.888     0.500000       375643         2.00
       0.937     0.550000       412991         2.22
       0.986     0.600000       450572         2.50
       1.034     0.650000       487757         2.86
       1.083     0.700000       525218         3.33
       1.132     0.750000       562514         4.00
       1.157     0.775000       581417         4.44
       1.183     0.800000       600554         5.00
       1.209     0.825000       619279         5.71
       1.237     0.850000       637954         6.67
       1.268     0.875000       656724         8.00
       1.285     0.887500       666052         8.89
       1.303     0.900000       674998        10.00
       1.323     0.912500       684294        11.43
       1.346     0.925000       693753        13.33
       1.372     0.937500       703275        16.00
       1.386     0.943750       707928        17.78
       1.401     0.950000       712504        20.00
       1.418     0.956250       717180        22.86
       1.436     0.962500       721797        26.67
       1.458     0.968750       726611        32.00
       1.469     0.971875       728841        35.56
       1.482     0.975000       731146        40.00
       1.497     0.978125       733592        45.71
       1.513     0.981250       735928        53.33
       1.532     0.984375       738172        64.00
       1.544     0.985938       739378        71.11
       1.556     0.987500       740502        80.00
       1.571     0.989062       741718        91.43
       1.590     0.990625       742896       106.67
       1.611     0.992188       744024       128.00
       1.625     0.992969       744615       142.22
       1.643     0.993750       745210       160.00
       1.664     0.994531       745789       182.86
       1.692     0.995313       746362       213.33
       1.738     0.996094       746945       256.00
       1.768     0.996484       747237       284.44
       1.820     0.996875       747535       320.00
       1.905     0.997266       747822       365.71
       2.041     0.997656       748116       426.67
       2.233     0.998047       748408       512.00
       2.357     0.998242       748557       568.89
       2.483     0.998437       748702       640.00
       2.633     0.998633       748847       731.43
       2.801     0.998828       748995       853.33
       2.971     0.999023       749140      1024.00
       3.075     0.999121       749213      1137.78
       3.185     0.999219       749287      1280.00
       3.317     0.999316       749360      1462.86
       3.471     0.999414       749433      1706.67
       3.651     0.999512       749506      2048.00
       3.721     0.999561       749543      2275.56
       3.867     0.999609       749581      2560.00
       3.977     0.999658       749619      2925.71
       4.115     0.999707       749653      3413.33
       4.279     0.999756       749689      4096.00
       4.363     0.999780       749709      4551.11
       4.455     0.999805       749726      5120.00
       4.571     0.999829       749745      5851.43
       4.711     0.999854       749763      6826.67
       4.875     0.999878       749782      8192.00
       4.935     0.999890       749791      9102.22
       5.035     0.999902       749799     10240.00
       5.099     0.999915       749808     11702.86
       5.179     0.999927       749818     13653.33
       5.267     0.999939       749827     16384.00
       5.299     0.999945       749831     18204.44
       5.427     0.999951       749837     20480.00
       5.551     0.999957       749840     23405.71
       5.671     0.999963       749845     27306.67
       5.755     0.999969       749850     32768.00
       5.831     0.999973       749852     36408.89
       5.887     0.999976       749854     40960.00
       5.915     0.999979       749856     46811.43
       6.123     0.999982       749859     54613.33
       6.323     0.999985       749861     65536.00
       6.383     0.999986       749862     72817.78
       6.467     0.999988       749863     81920.00
       6.507     0.999989       749864     93622.86
       6.891     0.999991       749866    109226.67
       6.919     0.999992       749867    131072.00
       6.919     0.999993       749867    145635.56
       7.059     0.999994       749868    163840.00
       7.059     0.999995       749868    187245.71
       8.295     0.999995       749869    218453.33
       8.775     0.999996       749870    262144.00
       8.775     0.999997       749870    291271.11
       8.775     0.999997       749870    327680.00
       8.775     0.999997       749870    374491.43
      10.679     0.999998       749871    436906.67
      10.679     0.999998       749871    524288.00
      10.679     0.999998       749871    582542.22
      10.679     0.999998       749871    655360.00
      10.679     0.999999       749871    748982.86
      12.607     0.999999       749872    873813.33
      12.607     1.000000       749872          inf
***
    #[Mean    =        0.889, StdDeviation   =        0.339]
    #[Max     =       12.600, Total count    =       749872]
    #[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
900014 requests in 1.00m, 58.26MB read

Requests/sec:  15000.86

Transfer/sec:      0.97MB

Выводы
-

В качестве алгоритма распределения данных между узлами был выбран Rendezvous hashing.

При изменении числа нод с 1 во 2 этапе на 2 в текущем этапе незначительно поднялся latency на PUT запросах (с

840us до 0.94ms) и для GET запросов (с 690us до 0.9ms). Данную разницу можно объяснить дополнительным временем по

сетевому взаимодействию по протоколу HTTP между нодами. Кроме того, было произведено сравнение кластеров из 2 нод и

5 нод. Для PUT запросов latency изменилось с 0.94ms для 2 нод до 1.07ms для 5 нод. Для GET запросов

latency изменилось с 0.90ms для 2 нод до 0.89ms для 5 нод. Данные результаты можно объяснить так: при увеличении числа

нод производительность системы не изменяется, поскольку внешние клиенты отправляют запросы на одну из нод, которая

в свою очередь либо обрабатывает запрос, либо пересылает на ноду, ответственную за ключ. Увеличение числа нод дает лишь

большую разгрузку каждой из нод из-за того, что пары "ключ-значение" распределяются по бОльшему числу нод, но при этом

алгоритм выполнения запросов не изменяется. Также 99% запросов на GET и PUT запросах выполняются примерно за 2ms, что

говорит о том, что часть запросов пересылаются на соседние ноды, чтобы получить с них данные (по протоколу HTTP),

поэтому данная задержка является довольно существенной (увеличение latency примерно в 2 раза).

PUT профилирование (3 ноды, 64 соединения, 64 потока):

По сравнению с этапом 2 нагрузку на CPU добавился SequentialScheduler (11.07% времени), который отвечает за управление

асинхронными HTTP запросами между нодами (например, попытки получить ответ от ноды (tryAsyncReceive)). Кроме того,

добавился SocketTube.InternalWriteSubscriber, который отвечает за запись в сокет (SocketDispatcher.writev). Это бывает

необходимо, когда от ноды приходит response другой ноде в асинхронном режиме. HttpClientImpl.SelectorManager 

(13.25% времени) отвечает за формирование синхронной очереди, которая используется для обработки событий, приходящих на

клиент. По сравнению со stage2 добавились аллокации на HttpClientImpl.SelectorManager (1.26%), SequentialScheduler

(11.47%) и SocketTube.InternalWriteSubscriber (3.58%). Появились локи, связанные с HttpClientImpl.SelectorManager

(21.42%). Это связано с синхронной обработкой событий, приходящих на клиент, и при обмене request-response между нодами.

GET профилирование (3 ноды, 64 соединения, 64 потока):

По сравнению со 2 этапом появился HttpClientImpl.SelectorManager (16.09% времени), SequentialScheduler (11.74% времени),

SocketTube.InternalWriteSubscriber (7.16% времени). 56.59% аллокаций идет на работу ThreadPoolExecutor. При этом

примерно 15% аллокаций приходится на взаимодействие с БД, остальное - идет на сетевое взаимодействие (формирование

заголовков, путей, чтение запросов). По сравнению со stage2 добавились аллокации на SequentialScheduler (12.69%) и 

SocketTube.InternalWriteSubscriber (1.84%). 

В качестве улучшений текущего stage хочу выделить изменение протокола передачи информации между нодами внутри кластера.

Кроме того, алгоритм распределения данных между узлами Consistent Hashing несколько более быстрый, чем Rendezvous

Hashing, поскольку определение физической ноды по виртуальной занимает логарифмическое время, в отличие от линейного

поиска максимального хэша из пары (ключ - номер ноды) в Rendezvous Hashing. Также можно добавить автоматический compact

для более ускоренного мерджа таблиц при поиске записей и удаления могил. Также стоит добавить блум фильтр для того,

чтобы пропускать таблицы, в которых гарантированно не содержится искомый ключ, что опять же сократит количество

системных обращений.